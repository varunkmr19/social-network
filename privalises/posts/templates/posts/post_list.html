{% load static %}
{% load crispy_forms_tags %}

<!DOCTYPE html>
<html lang="en">
	<head>
		<script src="https://ajax.googleapis.com/ajax/libs/jquery/3.4.1/jquery.min.js"></script>
		<meta charset="UTF-8">
		<meta name="viewport" content="width=device-width, initial-scale=1.0">
		<link rel="preconnect" href="https://fonts.googleapis.com">
		<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
		<link href="https://fonts.googleapis.com/css2?family=Roboto:wght@300&family=Ubuntu:wght@300&display=swap" rel="stylesheet">

		<link rel="stylesheet" href="{% static 'css/main.css' %}">
		<link rel="stylesheet" href="{% static 'css/logo.css' %}">
        <link rel="stylesheet" href="{% static 'css/home/scrollbar.css' %}">
        <link rel="stylesheet" href="{% static 'css/home/post.css' %}">
        <link rel="stylesheet" href="{% static 'css/home/content.css' %}">
        <link rel="stylesheet" href="{% static 'css/home/navbar.css' %}">
		<script src="{% static 'js/theme.js' %}"></script>

	</head>

	<body id="body" class="dark">
		<nav id="navbar" class="navbar dark">
			<ul class="navbar-nav">
				<li class="nav-item">
					<img id="logo" class="icon" src="{% static 'img/placeholder.png' %}">
				</li>

				<li class="nav-item">
					<a href="{% url 'home' %}" class="nav-link">
						<img src="{% static 'img/home_black.png' %}" alt="Home link icon">
						<span class="link-text">Home</span>
					</a>
				</li>

				<li class="nav-item">
					<a href="{% url 'search' %}" class="nav-link">
						<img src="{% static 'img/search_black.png' %}" alt="Search link icon">
						<span class="link-text">Search</span>
					</a>
				</li>

				<li class="nav-item">
					<a href="/notifications" class="nav-link">
						<img src="{% static 'img/bell_black.png' %}" alt="Notifications link icon">
						<span class="link-text">Notifications</span>
					</a>
				</li>

				<li class="nav-item">
					<a href="/dms" class="nav-link">
						<img src="{% static 'img/message_black.png' %}" alt="Messages link icon">
						<span class="link-text">Messages</span>
					</a>
				</li>

				<li class="nav-item">
					<a href="{% url 'profile' request.user.id %}" class="nav-link">
						<img src="{% static 'img/user_black.png' %}" alt="Profile link icon"> 
						<span class="link-text">Profile</span>
					</a>
				</li>

				<li class="nav-item theme-selectors">
					<input type="image" id="moon" class="theme" src="{% static 'img/moon.png' %}" onclick="changetheme(this)"/>
					<input type="image" id="sun" class="theme active" src="{% static 'img/sun.png' %}" onclick="changetheme(this)"/>
				</li>
			</ul>
			
			
		</nav>

		<main class="content">
			<div class="logo-text" style="margin-bottom: 1rem;">
				<div>Priva<span>Lise</span></div>
			</div>
{% for post in posts %}
			<div class="post">
				<div class="profile-container">
					<img class="profile" src="{{ post.author.profile.image.url }}">
				</div>

				<div class="post-content">
					<div class="post-info1">
						<a class="username" href="{% url 'profile' post.author.id %}">@{{ post.author }}</a>
						<p class="date">{{ post.date_posted }}</p>
					</div>

					<a href="{% url 'post-detail' post.pk %}"><div class="post-text">
						<p>{{ post.content }}</p>
					</div></a>

					<div class="social_buttons">
						<button class="social_button share">SHARE</button>

						<div class="like-dislike">{% csrf_token %}
							<button id="like-button"  value="{{ post.id }}" class="social_button
                             {% if post.likes.id == request.user.id %}
                               active
                             {% endif %}


							 like">
								<svg width="100px" height="100px" version="1.1" viewBox="0 0 100 100">
									<g id="layer1" transform="translate(55 65)">
										<path id="path2622" d="m25.45-41.897c-8.8052-9.6393-23.081-9.6393-31.887 2e-6l-0.00511 0.0055-0.00511-0.0055c-8.8052-9.6392-23.081-9.6393-31.887 0-8.8052 9.6393-8.8052 25.268 0 34.907l0.0051 0.00546 31.887 34.907 31.887-34.907 5e-3 -0.00546c8.8052-9.6393 8.8052-25.268 1e-6 -34.907z"/>
									</g>
								</svg>
							</button>

							<p class="count" id='like_count'>
								{{ post.like_count }}
							</p>
						</div>

						<button class="social_button reply">Comment</button>
					</div>

					<div class="reply_accordion">
						<button class="accordion_button" type="button">
							Show Comments
						</button><br/>
                        {{ post.comments.count }} comments
						<div class="replies">
							<div class="post reply">
								<div class="profile-container">
									<img class="profile" src="">
								</div>

								<div class="post-content">
									<div class="post-info">
										<div class="post-info1">
											<a class="username" href="/bradkitt">@bradkitt</a>
											<p class="date">3h ago</p>
										</div>

										<p class="info">Replying to <a class="username" href="/theawesomecat64">@theawesomecat64</a></p>
									</div>
									<div class="post-text">
										<p>Dude... are u ok??</p>
									</div>
								</div>
							</div>

							<div class="post reply">
								<div class="profile-container">
									<img class="profile" src="resources/example_profile3.jpg">
								</div>
		
								<div class="post-content">
									<div class="post-info">
										<div class="post-info1">
											<a class="username" href="/bradkitt">@bradkitt</a>
											<p class="date">3h ago</p>
										</div>
		
										<p class="info">Replying to <a class="username" href="/theawesomecat64">@theawesomecat64</a></p>
									</div>
									<div class="post-text">
										<p>Dude... are u ok??</p>
									</div>
								</div>
							</div>
						</div>
					</div>
				</div>
			</div>
			{% endfor %}	
		<script>
			document.querySelectorAll(".accordion_button").forEach(button => {
				button.addEventListener('click', () => {
					const accordionContent = button.nextElementSibling; // the "replies" div

					button.classList.toggle('active');

					if(button.classList.contains('active'))
						accordionContent.style.maxHeight = accordionContent.scrollHeight + 'px';
					else
						accordionContent.style.maxHeight = 0;

				});
			});

			document.querySelectorAll(".social_button").forEach(button => {
				button.addEventListener('click', () => {
					button.classList.toggle('active');

					/*if(button.classList.contains('like')){
						let likesElem = button.nextElementSibling;
						let likes = parseInt(likesElem.textContent) + (button.classList.contains("active")?+1:-1);

						let dislikeButton = button.nextElementSibling.nextElementSibling;
						if(dislikeButton.classList.contains("active")){
							likes += 1;
							dislikeButton.classList.remove('active');
						}

						likesElem.textContent = '+' + likes;
						
					}else if(button.classList.contains('dislike')){
						let likesElem = button.previousElementSibling;
						let likes = parseInt(likesElem.textContent) + (button.classList.contains("active")?-1:+1);

						let likeButton = button.previousElementSibling.previousElementSibling;
						if(likeButton.classList.contains("active")){
							likes -= 1;
							likeButton.classList.remove('active');
						}
						
						likesElem.textContent = '+' + likes;
					}*/
				});
			});
		</script>
        <script>
  $(document).on('click', '#like-button', function (e) {
    e.preventDefault();
    $.ajax({
      type: 'POST',
      url: '{% url "add-like" %}',
      data: {
        postid: $('#like-button').val(),
        csrfmiddlewaretoken: $('input[name=csrfmiddlewaretoken]').val(),
        action: 'post'
      },
      success: function (json) {
        document.getElementById("like_count").innerHTML = json['result']
        console.log(json)
      },
      error: function (xhr, errmsg, err) {

      }
    });
  })
</script>
		
	</body>
</html>